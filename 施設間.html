<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é¹¿å…å³¶çœŒãƒ‰ã‚¯ã‚¿ãƒ¼ãƒ˜ãƒª æ–½è¨­é–“æ¬é€è¦è«‹ãƒ•ã‚©ãƒ¼ãƒ </title>
<meta name="robots" content="noindex, nofollow">
<style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');

    :root {
        --primary: #0056b3;
        --primary-light: #e3f2fd;
        --accent: #d32f2f;
        --bg-body: #f5f5f5;
        --border: #ddd;
        --text: #333;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
        font-family: 'Noto Sans JP', sans-serif;
        color: var(--text);
        background-color: var(--bg-body);
        line-height: 1.4;
        padding: 15px;
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
    .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    header {
        text-align: center;
        border-bottom: 3px solid var(--primary);
        padding-bottom: 10px;
        margin-bottom: 20px;
    }

    h1 { font-size: 22px; color: var(--primary); margin-bottom: 5px; }
    .subtitle { font-size: 13px; color: #666; }

    .step-box {
        border: 2px solid var(--primary);
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 15px;
        background: white;
    }

    .step-header {
        display: flex;
        align-items: center;
        background: var(--primary-light);
        padding: 6px 10px;
        border-radius: 4px;
        margin-bottom: 12px;
        font-weight: 700;
        color: var(--primary);
        font-size: 15px;
    }

    .step-num {
        background: var(--primary);
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 8px;
        font-size: 14px;
    }

    .arrow-down {
        text-align: center;
        color: var(--primary);
        font-size: 20px;
        margin: -8px 0 8px;
        font-weight: bold;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ å‘¨ã‚Š */
    .form-section {
        margin-bottom: 12px;
        padding: 12px;
        border: 1px solid #eee;
        border-radius: 4px;
        background-color: #fdfdfd;
    }

    .section-title {
        font-size: 14px;
        font-weight: bold;
        color: #004085;
        border-bottom: 2px solid #cce5ff;
        margin-bottom: 10px;
        padding-bottom: 3px;
    }

    .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-bottom: 12px;
        align-items: flex-end;
    }

    .form-group {
        flex: 1;
        min-width: 140px;
    }

    label {
        display: block;
        font-size: 12px;
        font-weight: bold;
        margin-bottom: 4px;
        color: #444;
    }

    input[type="text"], input[type="number"], select, textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
    }
    
    input:focus, select:focus, textarea:focus {
        border-color: var(--primary);
        outline: none;
        background-color: #f0f8ff;
    }

    /* æ•°å€¤å…¥åŠ›ã®ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ */
    input:invalid {
        border-color: var(--accent);
        background-color: #fff0f0;
    }

    textarea { height: 60px; resize: vertical; }

    /* ç”Ÿå¹´æœˆæ—¥ã‚¨ãƒªã‚¢ */
    .dob-wrapper {
        display: flex;
        gap: 4px;
        align-items: center;
        flex-wrap: wrap; 
    }
    .dob-select {
        padding: 6px 2px;
        border: 1px solid #ccc;
        border-radius: 4px;
        text-align: center;
        font-size: 14px;
    }
    #dobEra { width: 75px; }
    #dobYear { width: 55px; }
    #dobMonth { width: 50px; }
    #dobDay { width: 50px; }
    #ptAge { 
        width: 60px !important; 
        min-width: 50px; 
        text-align: center; 
        background: #eee;
        padding: 6px 2px;
    }

    /* ãƒã‚¤ã‚¿ãƒ«ã‚¨ãƒªã‚¢ */
    .vital-wrapper {
        background-color: #e8f4fd;
        padding: 12px;
        border-radius: 6px;
        border: 1px solid #b8daff;
    }
    
    .vital-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 8px;
    }
    
    .vital-item {
        flex: 1;
        min-width: 90px;
    }
    
    .vital-item label {
        font-size: 11px;
        color: #0056b3;
        margin-bottom: 2px;
    }

    select.vital-select {
        padding: 6px;
        padding-right: 20px;
    }

    /* å‘¼å¸å™¨ãƒ‘ãƒãƒ« */
    .detail-panel {
        display: none;
        background: #fff;
        border: 1px solid #ccc;
        padding: 8px;
        border-radius: 4px;
        margin-top: 5px;
        font-size: 13px;
    }
    .detail-panel.active { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .resp-setting-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 8px;
    }
    .resp-input-label { font-size: 10px; color: #555; }
    .resp-input { padding: 4px; font-size: 13px; }

    /* è–¬å‰¤ãƒªã‚¹ãƒˆ (ã‚°ãƒªãƒƒãƒ‰åŒ–ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«) */
    .drug-list { display: flex; flex-direction: column; gap: 10px; }
    
    .drug-category {
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
    }
    .drug-category:last-child { border-bottom: none; }

    .category-label {
        font-size: 12px;
        color: #0056b3;
        font-weight: bold;
        margin-bottom: 5px;
        display: block;
    }

    .drug-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); /* å¹…ã«åˆã‚ã›ã¦è‡ªå‹•æŠ˜ã‚Šè¿”ã— */
        gap: 6px;
    }

    .drug-item {
        display: flex;
        align-items: center;
        gap: 5px;
        padding: 4px 6px;
        border: 1px solid #f0f0f0;
        border-radius: 4px;
        background: #fff;
        transition: all 0.2s;
        font-size: 13px;
    }
    
    /* ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .drug-item:has(input:checked) {
        border-color: #b8daff;
        background-color: #e8f4fd;
    }

    .drug-item label {
        margin: 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        flex-shrink: 0;
    }
    .drug-item input[type="checkbox"] {
        margin-right: 5px;
        transform: scale(1.1);
    }

    /* å…¥åŠ›æ¬„è¡¨ç¤ºåˆ¶å¾¡ */
    .drug-input-area { 
        display: none; 
        flex: 1; 
        margin-left: 5px;
    }
    .rate-input { 
        width: 100% !important; 
        padding: 4px !important; 
        font-size: 12px !important; 
        border: 1px solid #ccc;
        border-radius: 3px;
        height: 26px;
    }

    /* è­¦å‘Š */
    .alert-box {
        display: none;
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
        padding: 8px;
        margin-top: 8px;
        border-radius: 4px;
        font-weight: bold;
        font-size: 13px;
    }
    
    /* ä»˜æ·»äººè­¦å‘Šç”¨ */
    .warning-text-box {
        display: none;
        background-color: #ffebee;
        color: #c62828;
        border: 1px solid #ef9a9a;
        padding: 10px;
        margin-top: 10px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        line-height: 1.5;
    }

    /* é¸æŠè‚¢ã‚°ãƒ«ãƒ¼ãƒ— */
    .selection-group { display: flex; flex-wrap: wrap; gap: 8px; }
    .check-label {
        display: inline-flex;
        align-items: center;
        background: #eee;
        padding: 6px 10px;
        border-radius: 16px;
        cursor: pointer;
        font-size: 13px;
        border: 1px solid #ddd;
        user-select: none;
    }
    .check-label:hover { background: #e2e6ea; }
    .check-label input { margin-right: 6px; transform: scale(1.1); }
    .check-label:has(input:checked) {
        background: #cce5ff;
        border-color: #b8daff;
        color: #004085;
        font-weight: bold;
    }

    .input-wrapper {
        background: #f8f9fa;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #eee;
        margin-bottom: 8px;
    }
    .input-wrapper-title {
        font-size: 12px;
        font-weight: bold;
        color: #0056b3;
        margin-bottom: 6px;
        border-left: 3px solid #0056b3;
        padding-left: 6px;
        background: #eef;
    }

    /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
    .action-area {
        text-align: center;
        margin-top: 15px;
        padding: 15px;
        background: #f0f8ff;
        border-radius: 8px;
        border: 2px dashed var(--primary);
    }
    .btn-send {
        background-color: var(--primary);
        color: white;
        font-size: 16px;
        font-weight: bold;
        padding: 12px 40px;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        box-shadow: 0 3px 5px rgba(0,0,0,0.2);
    }
    .btn-send:hover { background-color: #003d80; }
    .btn-copy {
        background-color: #6c757d;
        color: white;
        font-size: 13px;
        padding: 6px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 8px;
    }
    .status-message { margin-top: 8px; font-weight: bold; color: var(--accent); min-height: 1.4em; }
    .decision-info {
        background: #fff3e0;
        border: 1px solid #ffcc80;
        padding: 8px;
        border-radius: 4px;
        text-align: center;
        font-weight: bold;
        color: #e65100;
        margin-top: 12px;
        font-size: 14px;
    }
    .red-text { color: var(--accent); }

    @media print {
        body { padding: 0; background: white; }
        .container { box-shadow: none; padding: 0; max-width: 100%; }
        .btn-send, .btn-copy, .alert-box { display: none; }
        .action-area { border: none; background: white; text-align: left; padding: 0; }
        .detail-panel { display: block !important; border: none; padding: 0; }
        .drug-input-area { display: flex !important; }
        .warning-text-box { display: block !important; border: none; color: black; padding: 0; background: none; }
        #drainSetting { display: inline-block !important; }
    }
</style>
</head>
<body>

<div class="container">
    <header>
        <h1>é¹¿å…å³¶çœŒãƒ‰ã‚¯ã‚¿ãƒ¼ãƒ˜ãƒª æ–½è¨­é–“æ¬é€è¦è«‹ãƒ•ã‚©ãƒ¼ãƒ </h1>
        <div class="subtitle">Webå…¥åŠ›ãƒ»é€ä¿¡ã‚·ã‚¹ãƒ†ãƒ </div>
    </header>

    <!-- STEP 1 -->
    <div class="step-box">
        <div class="step-header">
            <span class="step-num">1</span>
            <span>æ¬é€å…ˆã®ç¢ºä¿ï¼ˆå—ã‘å…¥ã‚Œèª¿æ•´ï¼‰</span>
        </div>
        <div style="padding-left: 10px;">
            <p style="font-size:14px;">ã¾ãšæ¬é€å…ƒåŒ»ç™‚æ©Ÿé–¢ã‹ã‚‰æ¬é€å…ˆåŒ»ç™‚æ©Ÿé–¢ã¸é€£çµ¡ã—ã€<strong>ã€Œå—ã‘å…¥ã‚Œå—è«¾ã€</strong>ã‚’å¾—ã¦ãã ã•ã„ã€‚</p>
            <p class="red-text" style="font-size: 12px; margin-top: 5px;">â€»ãƒ‰ã‚¯ã‚¿ãƒ¼ãƒ˜ãƒªæœ¬éƒ¨ï¼ˆCSï¼‰ã§ã¯ãƒ™ãƒƒãƒ‰èª¿æ•´ã¯è¡Œã„ã¾ã›ã‚“ã€‚</p>
        </div>
    </div>

    <div class="arrow-down">â¬‡</div>

    <!-- STEP 2: INPUT FORM -->
    <div class="step-box">
        <div class="step-header">
            <span class="step-num">2</span>
            <span>æ‚£è€…æƒ…å ±ã®å…¥åŠ›ãƒ»é€ä¿¡ï¼ˆCSã¸é€£çµ¡ï¼‰</span>
        </div>
        
        <p style="margin-bottom: 12px; font-size: 13px;">ä»¥ä¸‹ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã€ã€Œãƒ¡ãƒ¼ãƒ«ä½œæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚æ‚£è€…æ°åã‚„ä½æ‰€ãªã©å€‹äººã‚’ç‰¹å®šã—ã†ã‚‹æƒ…å ±ã¯è¨˜å…¥ã—ãªã„ã§ãã ã•ã„ã€‚</p>

        <form id="heliRequestForm">
            <!-- â‘  æ¬é€å…ƒãƒ»æ¬é€å…ˆæƒ…å ± -->
            <div class="form-section">
                <div class="section-title">â‘  æ¬é€å…ƒãƒ»æ¬é€å…ˆæƒ…å ±</div>
                
                <!-- æ¬é€å…ƒ -->
                <div style="margin-bottom: 10px; border: 1px solid #cce5ff; padding: 8px; border-radius: 4px; background: #f0f8ff;">
                    <label style="color:#004085; font-weight:bold; border-bottom:1px solid #b8daff; display:block; margin-bottom:6px;">ã€æ¬é€å…ƒã€‘</label>
                    <div class="form-row" style="margin-bottom:0; gap:8px;">
                        <div class="form-group" style="flex:2;">
                            <label>åŒ»ç™‚æ©Ÿé–¢å</label>
                            <input type="text" id="srcHospital" placeholder="ä¾‹ï¼šã€‡ã€‡ç—…é™¢">
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label>è¨ºç™‚ç§‘</label>
                            <input type="text" id="srcDept" placeholder="ä¾‹ï¼šæ•‘æ€¥ç§‘">
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label>æ‹…å½“åŒ»å</label>
                            <input type="text" id="srcDoctor" placeholder="æ°å">
                        </div>
                    </div>
                </div>

                <!-- æ¬é€å…ˆ -->
                <div style="border: 1px solid #ffeeba; padding: 8px; border-radius: 4px; background: #fff3cd;">
                    <label style="color:#856404; font-weight:bold; border-bottom:1px solid #ffeeba; display:block; margin-bottom:6px;">ã€æ¬é€å…ˆã€‘ (å—å…¥åŒ»ç™‚æ©Ÿé–¢)</label>
                    <div class="form-row" style="margin-bottom:0; gap:8px;">
                        <div class="form-group" style="flex:2;">
                            <label>åŒ»ç™‚æ©Ÿé–¢å</label>
                            <input type="text" id="dstHospital" placeholder="ä¾‹ï¼šé¹¿å…å³¶å¸‚ç«‹ç—…é™¢">
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label>è¨ºç™‚ç§‘</label>
                            <input type="text" id="dstDept" placeholder="ä¾‹ï¼šæ•‘æ€¥ç§‘">
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label>æ‹…å½“åŒ»å</label>
                            <input type="text" id="dstDoctor" placeholder="æ°å">
                        </div>
                    </div>
                </div>
            </div>

            <!-- â‘¡ æ‚£è€…åŸºæœ¬å±æ€§ -->
            <div class="form-section">
                <div class="section-title">â‘¡ æ‚£è€…åŸºæœ¬å±æ€§</div>
                
                <div class="form-row">
                    <!-- å¹´é½¢å…¥åŠ› (ãƒ€ã‚¤ãƒ¤ãƒ«å¼) -->
                    <div class="form-group" style="flex: 1; min-width: 120px;">
                        <label>å¹´é½¢ (é¸æŠ)</label>
                        <div style="display:flex; align-items:center;">
                            <select id="ptAge" class="vital-select" style="width: 80px; text-align:center; font-size:16px; padding:8px;"></select>
                            <span style="margin-left:5px; font-weight:bold;">ä»£</span>
                        </div>
                    </div>
                    
                    <div class="form-group" style="flex: 1; min-width: 120px;">
                        <label>æ€§åˆ¥</label>
                        <div class="selection-group">
                            <label class="check-label"><input type="radio" name="ptGender" value="ç”·æ€§" checked> ç”·</label>
                            <label class="check-label"><input type="radio" name="ptGender" value="å¥³æ€§"> å¥³</label>
                        </div>
                    </div>

                    <div class="form-group" style="flex: 1.5; min-width: 200px;">
                        <label>ä»˜æ·»äººï¼ˆå®¶æ—ç­‰ï¼‰</label>
                        <div class="selection-group">
                            <label class="check-label"><input type="radio" name="escort" value="ãªã—" checked onchange="toggleEscortWarning()"> ãªã—</label>
                            <label class="check-label"><input type="radio" name="escort" value="ã‚ã‚Š" onchange="toggleEscortWarning()"> ã‚ã‚Š</label>
                        </div>
                    </div>
                </div>
                
                <!-- ä»˜æ·»äººè­¦å‘Š -->
                <div id="escortWarning" class="warning-text-box">
                    âš  <strong>æ—¥æœ¬èˆªç©ºåŒ»ç™‚å­¦ä¼šã§ã¯ã€å®¶æ—ã¯åŸå‰‡æ­ä¹—ã•ã›ãªã„æ–¹é‡ã§ã‚ã‚Šã€é¹¿å…å³¶çœŒãƒ‰ã‚¯ã‚¿ãƒ¼ãƒ˜ãƒªã‚‚åŸå‰‡ã€å®¶æ—æ­ä¹—ã¯è¡Œã£ã¦ãŠã‚Šã¾ã›ã‚“ã€‚</strong>
                </div>
            </div>

            <!-- â‘¢ ç—…æ…‹ãƒ»çµŒéãƒ»ãƒã‚¤ã‚¿ãƒ« -->
            <div class="form-section">
                <div class="section-title">â‘¢ ç—…æ…‹ãƒ»è‡¨åºŠçµŒéãƒ»ãƒã‚¤ã‚¿ãƒ«</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>è¨ºæ–­åï¼ˆç—…åï¼‰</label>
                        <input type="text" id="diagnosis" placeholder="ä¾‹ï¼šæ€¥æ€§å¿ƒç­‹æ¢—å¡ã€è„³å‡ºè¡€ã€å¤šç™ºå¤–å‚·ãªã©">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>è‡¨åºŠçµŒéï¼ˆç™ºç—‡æ™‚é–“ã€ç¾çŠ¶ãªã©ï¼‰</label>
                        <textarea id="history" placeholder="ä¾‹ï¼šæœ¬æ—¥10æ™‚é ƒç™ºç—‡ã€æ„è­˜ãƒ¬ãƒ™ãƒ«ä½ä¸‹ã‚ã‚Šå½“é™¢æ¬é€..."></textarea>
                    </div>
                </div>
                
                <!-- ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³å…¥åŠ›ã‚¨ãƒªã‚¢ -->
                <div class="input-wrapper vital-wrapper">
                    <span class="input-wrapper-title" style="background:none; border:none; padding:0; margin-bottom:8px;">
                        â–  ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³ <span style="font-weight:normal; font-size:11px; color:#555;">(ã‚¯ãƒªãƒƒã‚¯ã—ã¦å¤‰æ›´)</span>
                    </span>
                    
                    <div class="vital-row">
                        <div class="vital-item" style="flex: 1.5; min-width: 160px;">
                            <label>è¡€åœ§ (mmHg)</label>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <select id="bpSys" class="vital-select" style="width: 70px;"></select> / 
                                <select id="bpDia" class="vital-select" style="width: 70px;"></select>
                            </div>
                        </div>
                        <div class="vital-item">
                            <label>è„ˆæ‹ <span class="vital-unit">(bpm)</span></label>
                            <select id="hr" class="vital-select"></select>
                        </div>
                        <div class="vital-item">
                            <label>SpO2 <span class="vital-unit">(%)</span></label>
                            <select id="spo2" class="vital-select"></select>
                        </div>
                        <div class="vital-item">
                            <label>å‘¼å¸æ•° <span class="vital-unit">(å›/åˆ†)</span></label>
                            <select id="rr" class="vital-select"></select>
                        </div>
                    </div>
                    
                    <div class="vital-row">
                         <div class="vital-item" style="flex: 2; min-width: 180px;">
                            <label>æ„è­˜ãƒ¬ãƒ™ãƒ«</label>
                            <div style="display:flex; gap:5px; align-items:center;">
                                <select id="consciousLevel" class="vital-select" style="flex:1;">
                                    <option value="JCS 0 (æ¸…æ˜)">JCS 0 (æ¸…æ˜)</option>
                                    <option value="JCS 1">JCS 1</option>
                                    <option value="JCS 2">JCS 2</option>
                                    <option value="JCS 3">JCS 3</option>
                                    <option value="JCS 10">JCS 10</option>
                                    <option value="JCS 20">JCS 20</option>
                                    <option value="JCS 30">JCS 30</option>
                                    <option value="JCS 100">JCS 100</option>
                                    <option value="JCS 200">JCS 200</option>
                                    <option value="JCS 300">JCS 300</option>
                                    <option value="é®é™ä¸­">é®é™ä¸­</option>
                                    <option value="ãã®ä»–">ãã®ä»–</option>
                                </select>
                            </div>
                        </div>
                        <div class="vital-item" style="flex: 1; min-width: 100px;">
                            <label>ä½“æ¸© <span class="vital-unit">(â„ƒ)</span></label>
                            <select id="temp" class="vital-select"></select>
                        </div>
                    </div>
                    <div style="margin-top:5px;">
                        <input type="text" id="vitalOther" placeholder="ãã®ä»–ãƒ»è©³ç´°ï¼ˆGCS E4V5M6ã€æ¸¬å®šä¸èƒ½ãªã©ï¼‰" style="font-size:12px; padding:5px;">
                    </div>
                </div>
            </div>

            <!-- â‘£ åŒ»ç™‚å‡¦ç½® -->
            <div class="form-section">
                <div class="section-title">â‘£ ç¾åœ¨ã®åŒ»ç™‚å‡¦ç½®</div>
                
                <!-- å‘¼å¸ç®¡ç† -->
                <div class="input-wrapper">
                    <span class="input-wrapper-title">â–  å‘¼å¸ç®¡ç†</span>
                    <div class="selection-group" style="margin-bottom: 5px;">
                        <label class="check-label"><input type="radio" name="respMode" value="å®¤å†…æ°—" checked onclick="toggleRespSettings('room')"> å®¤å†…æ°—</label>
                        <label class="check-label"><input type="radio" name="respMode" value="é…¸ç´ æŠ•ä¸" onclick="toggleRespSettings('o2')"> é…¸ç´ æŠ•ä¸</label>
                        <label class="check-label"><input type="radio" name="respMode" value="NPPV" onclick="toggleRespSettings('nppv')"> NPPV</label>
                        <label class="check-label"><input type="radio" name="respMode" value="æŒ¿ç®¡ãƒ»äººå·¥å‘¼å¸å™¨" onclick="toggleRespSettings('vent')"> æŒ¿ç®¡ãƒ»äººå·¥å‘¼å¸å™¨</label>
                    </div>

                    <!-- é…¸ç´ æŠ•ä¸è©³ç´° -->
                    <div id="panel-o2" class="detail-panel">
                        <label>é…¸ç´ æµé‡ãƒ»ãƒ‡ãƒã‚¤ã‚¹:</label>
                        <select id="o2Flow">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="ã‚«ãƒ‹ãƒ¥ãƒ¼ãƒ© 0.5L">ã‚«ãƒ‹ãƒ¥ãƒ¼ãƒ© 0.5L</option>
                            <option value="ã‚«ãƒ‹ãƒ¥ãƒ¼ãƒ© 1L">ã‚«ãƒ‹ãƒ¥ãƒ¼ãƒ© 1L</option>
                            <option value="ã‚«ãƒ‹ãƒ¥ãƒ¼ãƒ© 2L">ã‚«ãƒ‹ãƒ¥ãƒ¼ãƒ© 2L</option>
                            <option value="ã‚«ãƒ‹ãƒ¥ãƒ¼ãƒ© 3L">ã‚«ãƒ‹ãƒ¥ãƒ¼ãƒ© 3L</option>
                            <option value="ã‚«ãƒ‹ãƒ¥ãƒ¼ãƒ© 4L">ã‚«ãƒ‹ãƒ¥ãƒ¼ãƒ© 4L</option>
                            <option value="ãƒã‚¹ã‚¯ 5L">ãƒã‚¹ã‚¯ 5L</option>
                            <option value="ãƒã‚¹ã‚¯ 6L">ãƒã‚¹ã‚¯ 6L</option>
                            <option value="ãƒã‚¹ã‚¯ 8L">ãƒã‚¹ã‚¯ 8L</option>
                            <option value="ãƒã‚¹ã‚¯ 10L">ãƒã‚¹ã‚¯ 10L</option>
                            <option value="ãƒªã‚¶ãƒ¼ãƒãƒ¼ä»˜ãƒã‚¹ã‚¯ 10L">ãƒªã‚¶ãƒ¼ãƒãƒ¼ä»˜ãƒã‚¹ã‚¯ 10L</option>
                            <option value="ãƒªã‚¶ãƒ¼ãƒãƒ¼ä»˜ãƒã‚¹ã‚¯ 15L">ãƒªã‚¶ãƒ¼ãƒãƒ¼ä»˜ãƒã‚¹ã‚¯ 15L</option>
                        </select>
                    </div>

                    <!-- NPPVè©³ç´°ï¼ˆåˆ†é›¢ï¼‰ -->
                    <div id="panel-nppv" class="detail-panel">
                        <label style="margin-bottom:5px;">NPPVè¨­å®š:</label>
                        <div class="resp-setting-grid">
                            <div>
                                <div class="resp-input-label">Mode</div>
                                <select id="nppvMode" class="resp-input">
                                    <option value="">é¸æŠ</option>
                                    <option value="S/T">S/T</option>
                                    <option value="CPAP">CPAP</option>
                                    <option value="ãã®ä»–">ãã®ä»–</option>
                                </select>
                            </div>
                            <div>
                                <div class="resp-input-label">FiO2 (0.21-1.0)</div>
                                <input type="number" id="nppvFio2" class="resp-input" placeholder="0.4" step="0.01" min="0.21" max="1.0">
                            </div>
                            <div><div class="resp-input-label">IPAP</div><input type="number" id="nppvIpap" class="resp-input" placeholder="10" min="0"></div>
                            <div><div class="resp-input-label">EPAP</div><input type="number" id="nppvEpap" class="resp-input" placeholder="5" min="0"></div>
                            <div><div class="resp-input-label">f (å›/åˆ†)</div><input type="number" id="nppvF" class="resp-input" placeholder="12" min="0"></div>
                        </div>
                    </div>

                    <!-- äººå·¥å‘¼å¸å™¨è©³ç´°ï¼ˆåˆ†é›¢ï¼‰ -->
                    <div id="panel-vent" class="detail-panel">
                        <label style="margin-bottom:5px;">å‘¼å¸å™¨è¨­å®š:</label>
                        <div class="resp-setting-grid">
                            <div>
                                <div class="resp-input-label">Mode</div>
                                <select id="ventMode" class="resp-input">
                                    <option value="">é¸æŠ</option>
                                    <option value="A/C">A/C</option>
                                    <option value="PSV">PSV</option>
                                    <option value="SIMV">SIMV</option>
                                    <option value="APRV">APRV</option>
                                    <option value="ãã®ä»–">ãã®ä»–</option>
                                </select>
                            </div>
                            <div>
                                <div class="resp-input-label">FiO2 (0.21-1.0)</div>
                                <input type="number" id="ventFio2" class="resp-input" placeholder="0.4" step="0.01" min="0.21" max="1.0">
                            </div>
                            <div><div class="resp-input-label">PEEP</div><input type="number" id="ventPeep" class="resp-input" placeholder="5" min="0"></div>
                            <div><div class="resp-input-label">PS</div><input type="number" id="ventPs" class="resp-input" placeholder="10" min="0"></div>
                            <div><div class="resp-input-label">PI/Pinsp</div><input type="number" id="ventPi" class="resp-input" placeholder="15" min="0"></div>
                            <div><div class="resp-input-label">f (å›/åˆ†)</div><input type="number" id="ventF" class="resp-input" placeholder="12" min="0"></div>
                        </div>
                    </div>
                </div>

                <!-- å¾ªç’°ãƒ»è–¬å‰¤ -->
                <div class="input-wrapper">
                    <span class="input-wrapper-title">â–  å¾ªç’°ãƒ»è–¬å‰¤</span>
                    
                    <!-- ãƒ¡ã‚¤ãƒ³è¼¸æ¶² -->
<span>â€»ãƒ¡ã‚¤ãƒ³ã¯50mlã‚·ãƒªãƒ³ã‚¸ãƒãƒ³ãƒ—ã¸åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„</span>
                    <div style="margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:10px;">
                        <label style="font-size:12px; color:#555;">ãƒ¡ã‚¤ãƒ³è¼¸æ¶²:</label>
                        <div style="display:flex; gap:5px; flex-wrap:wrap;">
                            <select id="mainIvType" style="flex:1; min-width:150px;">
                                <option value="ãªã—">ãªã—</option>
                                <option value="ç´°èƒå¤–æ¶²(ç”Ÿé£Ÿ/ãƒªãƒ³ã‚²ãƒ«)">ç´°èƒå¤–æ¶²(ç”Ÿé£Ÿ/ãƒªãƒ³ã‚²ãƒ«)</option>
                                <option value="ç¶­æŒæ¶²(1å·/3å·)">ç¶­æŒæ¶²(1å·/3å·)</option>
                                <option value="ãã®ä»–">ãã®ä»–</option>
                            </select>
                            <input type="text" id="mainIvRate" placeholder="æµé‡ (ä¾‹: 80ml/h)" style="flex:1;">
                        </div>
                    </div>

                    <!-- ã‚·ãƒªãƒ³ã‚¸ãƒãƒ³ãƒ—è–¬å‰¤ç­‰ (ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º) -->
                    <div class="drug-list">
                        <!-- æ˜‡åœ§å‰¤ -->
                        <div class="drug-category">
                            <label class="category-label">æ˜‡åœ§å‰¤</label>
                            <div class="drug-grid">
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="pressor" value="ãƒãƒ«ã‚¢ãƒ‰ãƒ¬ãƒŠãƒªãƒ³"> ãƒãƒ«ã‚¢ãƒ‰</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡(Î³)"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="pressor" value="ã‚¤ãƒãƒãƒ³(ãƒ‰ãƒ‘ãƒŸãƒ³)"> ã‚¤ãƒãƒãƒ³</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="pressor" value="ãƒ‰ãƒ–ã‚¿ãƒŸãƒ³"> ãƒ‰ãƒ–ã‚¿ãƒŸãƒ³</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="pressor" value="ãƒ”ãƒˆãƒ¬ãƒƒã‚·ãƒ³"> ãƒ”ãƒˆãƒ¬ãƒƒã‚·ãƒ³</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                            </div>
                        </div>

                        <!-- é®é™å‰¤ -->
                        <div class="drug-category">
                            <label class="category-label">é®é™ãƒ»é®ç—›å‰¤</label>
                            <div class="drug-grid">
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="sedative" value="ãƒŸãƒ€ã‚¾ãƒ©ãƒ "> ãƒŸãƒ€ã‚¾ãƒ©ãƒ </label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡(mg/h)"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="sedative" value="ãƒ—ãƒ­ãƒãƒ•ã‚©ãƒ¼ãƒ«"> ãƒ—ãƒ­ãƒãƒ•ã‚©ãƒ¼ãƒ«</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="sedative" value="ãƒ—ãƒ¬ã‚»ãƒ‡ãƒƒã‚¯ã‚¹"> ãƒ—ãƒ¬ã‚»ãƒ‡ãƒƒã‚¯ã‚¹</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="sedative" value="ãƒ•ã‚§ãƒ³ã‚¿ãƒ‹ãƒ«"> ãƒ•ã‚§ãƒ³ã‚¿ãƒ‹ãƒ«</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="sedative" value="ãƒ¢ãƒ«ãƒ’ãƒ"> ãƒ¢ãƒ«ãƒ’ãƒ</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ãã®ä»–è–¬å‰¤ -->
                        <div class="drug-category">
                            <label class="category-label">ãã®ä»–</label>
                            <div class="drug-grid">
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="otherDrug" value="ãƒ‹ã‚³ãƒ©ãƒ³ã‚¸ãƒ«"> ãƒ‹ã‚³ãƒ©ãƒ³ã‚¸ãƒ«</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡/è©³ç´°"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="otherDrug" value="ãƒ‹ã‚«ãƒ«ã‚¸ãƒ”ãƒ³"> ãƒ‹ã‚«ãƒ«ã‚¸ãƒ”ãƒ³</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="otherDrug" value="ãƒªãƒ‰ã‚«ã‚¤ãƒ³"> ãƒªãƒ‰ã‚«ã‚¤ãƒ³</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="otherDrug" value="ã‚¢ãƒŸã‚ªãƒ€ãƒ­ãƒ³"> ã‚¢ãƒŸã‚ªãƒ€ãƒ­ãƒ³</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="otherDrug" value="ãƒ˜ãƒ‘ãƒªãƒ³"> ãƒ˜ãƒ‘ãƒªãƒ³</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="æµé‡"></div>
                                </div>
                                <div class="drug-item">
                                    <label><input type="checkbox" class="drug-check" name="otherDrug" value="ãã®ä»–è–¬å‰¤"> ãã®ä»–</label>
                                    <div class="drug-input-area"><input type="text" class="rate-input" placeholder="è–¬å‰¤åãƒ»æµé‡"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                    <div id="pumpWarning" class="alert-box">
                        âš  è­¦å‘Š: ã‚·ãƒªãƒ³ã‚¸ãƒãƒ³ãƒ—ä½¿ç”¨è–¬å‰¤ãŒå¤šæ•°é¸æŠã•ã‚Œã¦ã„ã¾ã™ã€‚<br>
                        ãƒ˜ãƒªæ­è¼‰ãƒãƒ³ãƒ—æ•°ã«åˆ¶é™ãŒã‚ã‚‹ãŸã‚ã€å¯èƒ½ãªé™ã‚Š<strong>3å‰¤ç¨‹åº¦</strong>ã¾ã§ã«æ¸›ã‚‰ã™ã‚ˆã†èª¿æ•´ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚<br>
                        è©³ç´°ã¯ãƒ•ãƒ©ã‚¤ãƒˆãƒ‰ã‚¯ã‚¿ãƒ¼ã¨ç›¸è«‡ã—ã¦ãã ã•ã„ã€‚
                    </div>
                </div>

                <!-- ãƒ‡ãƒã‚¤ã‚¹ -->
                <div class="input-wrapper">
                    <span class="input-wrapper-title">â–  ç•™ç½®ãƒ‡ãƒã‚¤ã‚¹</span>
                    <div class="selection-group" style="margin-bottom: 5px;">
                        <label class="check-label"><input type="checkbox" name="device" value="Aãƒ©ã‚¤ãƒ³"> Aãƒ©ã‚¤ãƒ³</label>
                        <label class="check-label"><input type="checkbox" name="device" value="CVC"> CVC</label>
                        <!-- èƒ¸è…”ãƒ‰ãƒ¬ãƒ¼ãƒ³ï¼šãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨è¨­å®šãƒ—ãƒ«ãƒ€ã‚¦ãƒ³è¡¨ç¤º -->
                        <div class="device-item-wrapper" style="display:inline-flex; align-items:center;">
                            <label class="check-label"><input type="checkbox" name="device" value="èƒ¸è…”ãƒ‰ãƒ¬ãƒ¼ãƒ³" id="chkDrain" onchange="toggleDrainSelect()"> èƒ¸è…”ãƒ‰ãƒ¬ãƒ¼ãƒ³</label>
                            <select id="drainSetting" style="display:none; margin-left:5px; width:auto; padding:2px; font-size:12px; border-radius:4px; border:1px solid #ccc;">
                                <option value="">è¨­å®šé¸æŠ</option>
                                <option value="-5cmH2O">-5cmH2O</option>
                                <option value="-10cmH2O">-10cmH2O</option>
                                <option value="-15cmH2O">-15cmH2O</option>
                                <option value="æ°´å°">æ°´å°</option>
                            </select>
                        </div>
                        <label class="check-label"><input type="checkbox" name="device" value="IABP"> IABP</label>
                        <label class="check-label"><input type="checkbox" name="device" value="PCPS/ECMO"> PCPS/ECMO</label>
                    </div>
                    <input type="text" id="deviceOther" class="sub-input" placeholder="ãã®ä»–ãƒ‡ãƒã‚¤ã‚¹ï¼ˆãƒšãƒ¼ã‚¹ãƒ¡ãƒ¼ã‚«ãƒ¼ç­‰ï¼‰">
                </div>
            </div>

            <!-- é€ä¿¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="action-area">
                <button type="button" class="btn-send" onclick="generateAndSendMail()">
                    ğŸ“§ ãƒ¡ãƒ¼ãƒ«ä½œæˆç”»é¢ã‚’èµ·å‹•<br>
                    <span style="font-size:12px; font-weight:normal;">(CSã¸æƒ…å ±ã‚’é€ä¿¡)</span>
                </button>
                <br>
                <div class="status-message" id="statusMsg"></div>
                <button type="button" class="btn-copy" onclick="copyToClipboard()">
                    ğŸ“‹ æœ¬æ–‡ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ (ãƒ¡ãƒ¼ãƒ«ãŒèµ·å‹•ã—ãªã„å ´åˆ:kch.densou@gmail.comã¾ã§é€ä¿¡)
                </button>
                <p class="note">â€»ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ãŠä½¿ã„ã®ãƒ¡ãƒ¼ãƒ«ã‚½ãƒ•ãƒˆãŒèµ·å‹•ã—ã¾ã™ã€‚<br>å†…å®¹ã‚’ç¢ºèªã—ã¦é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
            </div>
        </form>

        <div class="decision-info">
            <span style="font-size: 1.2em;">âš  ãƒ˜ãƒªå‡ºå‹•ã®å¯å¦ã¯ã€å—ä¿¡å¾Œã«ãƒ•ãƒ©ã‚¤ãƒˆã‚¹ã‚¿ãƒƒãƒ•ã«ã‚ˆã‚Šåˆ¤æ–­ã•ã‚Œã¾ã™ã€‚</span>
        </div>
    </div>

    <!-- STEP 3 & 4 (çœç•¥ãªã—) -->
    <div class="step-box">
        <div class="step-header"><span class="step-num">3</span><span>CSã¸ã®é›»è©±é€£çµ¡ï¼ˆé€ä¿¡ç¢ºèªï¼‰</span></div>
        <p>ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¾Œã€ç›´ã¡ã«<strong>æ–½è¨­é–“æ¬é€ç”¨é›»è©±ï¼ˆCSï¼‰</strong>ã¸é€£çµ¡ã—ã€ã€Œãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã—ãŸã€æ—¨ã‚’ä¼ãˆã¦ãã ã•ã„ã€‚ãƒ•ãƒ©ã‚¤ãƒˆã‚¹ã‚¿ãƒƒãƒ•ã¨æ¬é€å¯å¦ã‚’æ¤œè¨ã—ã¾ã™ã€‚</p>
    </div>
    <div class="arrow-down">â¬‡</div>
    <div class="step-box" style="border-color: var(--accent);">
        <div class="step-header" style="background: #ffebee; color: var(--accent);">
            <span class="step-num" style="background: var(--accent);">4</span><span>å¼•ãç¶™ãå ´æ‰€æ±ºå®šãƒ»119ç•ªè¦è«‹</span>
        </div>
        <p>æ¬é€ãŒå¯èƒ½ã¨é€£çµ¡ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€<strong>é€Ÿã‚„ã‹ã«119ç•ªè¦è«‹</strong>ã‚’è¡Œã£ã¦ä»¥ä¸‹ã®é †ã«ä¼é”ã—ã¦ãã ã•ã„ã€‚(FDç”¨ã®ç´¹ä»‹çŠ¶å†™ã—ã¨æ¬é€ä¸­æ€¥å¤‰æ™‚ã«å‚ç…§ã§ãã‚‹ãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‚­ãƒ¼ç”»åƒãŒã‚ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚)</p>
        <div style="background: #fff; border: 1px dashed var(--accent); padding: 10px; margin-top: 10px; font-size:13px;">
            <strong>ã€119ç•ªã§ä¼ãˆã‚‹ã“ã¨ã€‘</strong>
            <ul style="margin-left: 20px;">
                <li>ãƒ‰ã‚¯ã‚¿ãƒ¼ãƒ˜ãƒªã«ã‚ˆã‚‹æ–½è¨­é–“æ¬é€ã§ã‚ã‚‹ã“ã¨</li>
                <li>æ¬é€å…ƒç—…é™¢ã¨æ¬é€å…ˆç—…é™¢å</li>
                <li>æŒ‡å®šã•ã‚ŒãŸå¼•ãç¶™ãå ´æ‰€ï¼ˆç—…é™¢ã‹ãƒ©ãƒ³ãƒ‡ãƒ–ãƒ¼ãƒã‚¤ãƒ³ãƒˆã®ã©ã¡ã‚‰ã‹ï¼‰</li>
            </ul>
        </div>
    </div>

</div>

<!-- JavaScript Logic -->
<script>
    // ==========================================
    // ã€è¨­å®šã€‘ç®¡ç†è€…ã¯ä»¥ä¸‹ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„
    // ==========================================
    const CONFIG = {
        DESTINATION_EMAIL: "kch.densou@gmail.com"
    };

    window.onload = function() {
        populateSelect('bpSys', 40, 290, 120, 2);
        populateSelect('bpDia', 20, 160, 80, 2);
        populateSelect('hr', 20, 200, 80, 2);
        populateSelect('spo2', 30, 100, 98, 1, true);
        populateSelect('rr', 0, 60, 16, 1);
        populateTempSelect();
        
        // å¹´é½¢ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ç”Ÿæˆ
        populateAgeSelect();
        
        // è–¬å‰¤ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ç›£è¦–
        document.querySelectorAll('.drug-check').forEach(cb => {
            cb.addEventListener('change', (e) => {
                checkDrugCount();
                toggleDrugInput(e.target);
            });
        });
    };

    // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
    function populateSelect(id, min, max, defaultVal, step = 1, reverse = false) {
        const select = document.getElementById(id);
        const options = [];
        for (let i = min; i <= max; i += step) options.push(i);
        if (reverse) options.reverse();
        options.forEach(val => {
            const opt = document.createElement('option');
            opt.value = val;
            opt.textContent = val;
            if (val === defaultVal) opt.selected = true;
            select.appendChild(opt);
        });
    }

    function populateTempSelect() {
        const select = document.getElementById('temp');
        const defaultVal = "36.5";
        for (let i = 340; i <= 420; i++) {
            const val = (i / 10).toFixed(1);
            const opt = document.createElement('option');
            opt.value = val;
            opt.textContent = val;
            if (val === defaultVal) opt.selected = true;
            select.appendChild(opt);
        }
    }

    // å¹´é½¢ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ç”Ÿæˆ (0-120æ­³, åˆæœŸå€¤50)
    function populateAgeSelect() {
        const select = document.getElementById('ptAge');
        const defaultVal = 50;
        for (let i = 0; i <= 120; i++) {
            const opt = document.createElement('option');
            opt.value = i;
            opt.textContent = i;
            if (i === defaultVal) opt.selected = true;
            select.appendChild(opt);
        }
    }

    // ä»˜æ·»äººè­¦å‘Šã®è¡¨ç¤ºåˆ‡æ›¿
    function toggleEscortWarning() {
        const warning = document.getElementById('escortWarning');
        const radios = document.getElementsByName('escort');
        let val = "";
        for(let r of radios) { if(r.checked) val = r.value; }
        
        if(val === "ã‚ã‚Š") {
            warning.style.display = 'block';
        } else {
            warning.style.display = 'none';
        }
    }

    // å‘¼å¸å™¨è¨­å®šç­‰ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
    function toggleRespSettings(mode) {
        document.getElementById('panel-o2').classList.remove('active');
        document.getElementById('panel-nppv').classList.remove('active');
        document.getElementById('panel-vent').classList.remove('active');
        
        if (mode === 'o2') {
            document.getElementById('panel-o2').classList.add('active');
        } else if (mode === 'nppv') {
            document.getElementById('panel-nppv').classList.add('active');
        } else if (mode === 'vent') {
            document.getElementById('panel-vent').classList.add('active');
        }
    }

    // è–¬å‰¤å…¥åŠ›æ¬„ã®è¡¨ç¤ºåˆ‡æ›¿
    function toggleDrugInput(checkbox) {
        const item = checkbox.closest('.drug-item');
        const inputArea = item.querySelector('.drug-input-area');
        if (checkbox.checked) {
            inputArea.style.display = 'flex';
        } else {
            inputArea.style.display = 'none';
            // å…¥åŠ›å€¤ã‚’ã‚¯ãƒªã‚¢
            const input = inputArea.querySelector('input');
            if(input) input.value = '';
        }
    }

    // èƒ¸è…”ãƒ‰ãƒ¬ãƒ¼ãƒ³è¨­å®šã®è¡¨ç¤ºåˆ‡æ›¿
    function toggleDrainSelect() {
        const chk = document.getElementById('chkDrain');
        const select = document.getElementById('drainSetting');
        if (chk.checked) {
            select.style.display = 'inline-block';
        } else {
            select.style.display = 'none';
            select.value = ""; // å€¤ã‚’ã‚¯ãƒªã‚¢
        }
    }

    // è–¬å‰¤ã‚«ã‚¦ãƒ³ãƒˆãƒ»è­¦å‘Š
    function checkDrugCount() {
        const checks = document.querySelectorAll('.drug-check:checked');
        const warning = document.getElementById('pumpWarning');
        // ãƒ¡ã‚¤ãƒ³ä»¥å¤–ã®è–¬å‰¤ãŒ4å‰¤ä»¥ä¸Šé¸æŠã•ã‚ŒãŸå ´åˆ
        if (checks.length >= 2) {
            warning.style.display = 'block';
        } else {
            warning.style.display = 'none';
        }
    }

    function getFormData() {
        const getValue = (id) => document.getElementById(id).value || "";
        const getRadioVal = (name) => {
            const els = document.getElementsByName(name);
            for(let el of els) if(el.checked) return el.value;
            return "";
        };

        const now = new Date();
        const dateStr = `${now.getFullYear()}/${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;

        // === åŸºæœ¬æƒ…å ± ===
        const srcHosp = getValue('srcHospital');
        const srcDept = getValue('srcDept');
        const srcDr = getValue('srcDoctor');
        
        const dstHosp = getValue('dstHospital');
        const dstDept = getValue('dstDept');
        const dstDr = getValue('dstDoctor');

        // === ãƒã‚¤ã‚¿ãƒ« ===
        const bpSys = getValue('bpSys');
        const bpDia = getValue('bpDia');
        const hr = getValue('hr');
        const spo2 = getValue('spo2');
        const rr = getValue('rr');
        const consLevel = getValue('consciousLevel');
        const vitalOther = getValue('vitalOther');
        const temp = getValue('temp');

        let vitalStr = `BP ${bpSys}/${bpDia}, HR ${hr}, SpO2 ${spo2}%\nRR ${rr}, KT ${temp}, æ„è­˜ ${consLevel}`;
        if(vitalOther) vitalStr += ` (${vitalOther})`;

        // === å‘¼å¸ ===
        let respInfo = getRadioVal('respMode');
        if (respInfo === "é…¸ç´ æŠ•ä¸") {
            const flow = getValue('o2Flow');
            if(flow) respInfo += ` : ${flow}`;
        } else if (respInfo === "NPPV") {
            respInfo += `\n   Mode: ${getValue('nppvMode')}, FiO2: ${getValue('nppvFio2')}, IPAP: ${getValue('nppvIpap')}\n   EPAP: ${getValue('nppvEpap')}, f: ${getValue('nppvF')}`;
        } else if (respInfo === "æŒ¿ç®¡ãƒ»äººå·¥å‘¼å¸å™¨") {
            respInfo += `\n   Mode: ${getValue('ventMode')}, FiO2: ${getValue('ventFio2')}, PEEP: ${getValue('ventPeep')}\n   PS: ${getValue('ventPs')}, PI: ${getValue('ventPi')}, f: ${getValue('ventF')}`;
        }

        // === å¾ªç’°ãƒ»è–¬å‰¤ ===
        // ãƒ¡ã‚¤ãƒ³
        let mainIv = getValue('mainIvType');
        if (mainIv !== "ãªã—") mainIv += ` (${getValue('mainIvRate')})`;
        
        // æ˜‡åœ§å‰¤ãƒ»é®é™å‰¤ãƒ»ãã®ä»–
        let drugs = [];
        document.querySelectorAll('.drug-check:checked').forEach(cb => {
            const name = cb.value;
            // å¯¾å¿œã™ã‚‹æµé‡å…¥åŠ›æ¬„ã‚’æ¢ã™
            const row = cb.closest('.drug-item');
            const rate = row.querySelector('.rate-input').value;
            drugs.push(`${name} ${rate ? '('+rate+')' : ''}`);
        });

        // ãƒ‡ãƒã‚¤ã‚¹
        let devInfo = [];
        document.querySelectorAll('input[name="device"]:checked').forEach(cb => {
            let val = cb.value;
            // èƒ¸è…”ãƒ‰ãƒ¬ãƒ¼ãƒ³ãªã‚‰è¨­å®šå€¤ã‚’ä»˜åŠ 
            if (val === "èƒ¸è…”ãƒ‰ãƒ¬ãƒ¼ãƒ³") {
                const setting = document.getElementById('drainSetting').value;
                if (setting) val += ` (${setting})`;
            }
            devInfo.push(val);
        });
        const devOther = getValue('deviceOther');
        if(devOther) devInfo.push(devOther);
        
        return `
ã€ãƒ‰ã‚¯ã‚¿ãƒ¼ãƒ˜ãƒªæ–½è¨­é–“æ¬é€è¦è«‹ã€‘
è¦è«‹æ—¥æ™‚: ${dateStr}

â– æ¬é€å…ƒ
åŒ»ç™‚æ©Ÿé–¢: ${srcHosp}
è¨ºç™‚ç§‘: ${srcDept}
æ‹…å½“åŒ»: ${srcDr}

â– æ¬é€å…ˆ
åŒ»ç™‚æ©Ÿé–¢: ${dstHosp}
è¨ºç™‚ç§‘: ${dstDept}
æ‹…å½“åŒ»: ${dstDr}

â– æ‚£è€…æƒ…å ±
å¹´é½¢: ${getValue('ptAge')}æ­³
æ€§åˆ¥: ${getRadioVal('ptGender')}
ä»˜æ·»äºº: ${getRadioVal('escort')}

â– ç—…æ…‹æƒ…å ±
è¨ºæ–­å: ${getValue('diagnosis')}
è‡¨åºŠçµŒé: ${getValue('history')}

â– ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³
${vitalStr}

â– å‘¼å¸ç®¡ç†
${respInfo}

â– å¾ªç’°ãƒ»è–¬å‰¤
ãƒ¡ã‚¤ãƒ³è¼¸æ¶²: ${mainIv}
ä½¿ç”¨è–¬å‰¤: ${drugs.length > 0 ? drugs.join(', ') : 'ãªã—'}

â– ãƒ‡ãƒã‚¤ã‚¹
${devInfo.length > 0 ? devInfo.join(', ') : 'ãªã—'}

--------------------------------
â€»æœ¬ãƒ¡ãƒ¼ãƒ«ã¯Webãƒ•ã‚©ãƒ¼ãƒ ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚
â€»é€ä¿¡å¾Œã€å¿…ãšCSã¸é›»è©±é€£çµ¡ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚
        `.trim();
    }

    function generateAndSendMail() {
        const bodyText = getFormData();
        const subject = encodeURIComponent("ã€æ–½è¨­é–“æ¬é€è¦è«‹ã€‘Webãƒ•ã‚©ãƒ¼ãƒ ã‚ˆã‚Šé€ä¿¡");
        const body = encodeURIComponent(bodyText);
        const mailtoLink = `mailto:${CONFIG.DESTINATION_EMAIL}?subject=${subject}&body=${body}`;
        window.location.href = mailtoLink;
        document.getElementById('statusMsg').innerText = "ãƒ¡ãƒ¼ãƒ«ã‚½ãƒ•ãƒˆã‚’èµ·å‹•ã—ã¾ã—ãŸã€‚é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚";
    }

    function copyToClipboard() {
        const bodyText = getFormData();
        navigator.clipboard.writeText(bodyText).then(() => {
            alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚");
            document.getElementById('statusMsg').innerText = "æœ¬æ–‡ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚";
        }).catch(err => {
            alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        });
    }
</script>

</body>

</html>

